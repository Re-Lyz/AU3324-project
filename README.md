# AU3324-project

主要电气硬件构成：**DC 伺服电机、ESP32、TTL 到 RS485 模块、MPU6050 传感器、OLED 显示屏**

主要连接方式：

ESP32为主板，主要连接TTL模块、MPU6050 传感器和OLED 显示屏，然后TTL模块接上RS485，485接伺服电机，供电伺服电机是独立供电的，详细连接示意：

**电源部分**

- 将 24V 电源接到伺服电机。
- ESP32、MPU6050 和 OLED 显示屏则由 ESP32 的供电或独立稳定电源（确保共地）提供适合的电压（通常为 3.3V 或 5V）。

**ESP32 与 TTL 到 RS485 模块**

- ESP32 的 UART TX、RX 分别接到 TTL 模块的 TX、RX。
- 同时，选定的数字引脚（如 GPIO4）连接到 TTL 模块的 DE/RE 控制引脚，用于模式切换。

**TTL 到 RS485 模块与伺服电机**

- TTL 模块的 RS485 侧的 A/B 接口直接连接到伺服电机的 RS485 通信口（A 对 A，B 对 B）。

**ESP32 与 I2C 设备（MPU6050 与 OLED）**

- ESP32 的 SDA、SCL 分别连接到 MPU6050 和 OLED 显示屏的 SDA、SCL。
- 这两个设备共用同一组 I2C 总线，但需确保它们的 I2C 地址不冲突。


## 基于蓝牙连接的云台控制台（Console）

将设备连接到ESP32后启动服务器，支持云台数据监控与姿态控制







------

### 在 20 秒内实现 180° 旋转的速度规划（考虑整数 RPM 与整数 0.1 rps/s 精度）

由于伺服驱动器的参数需要以整数形式写入（例如速度以 **rpm** 表示且必须为整数，加速度以 **0.1 rps/s** 表示且也须为整数），我们在此给出两种示例方案——**梯形速度曲线**与**S 曲线**。目标是在 **20 秒**内完成 **180°** 的旋转（假设 1000 脉冲 = 360°，因此 180° 对应约 500 脉冲）。

---

## 一、背景与单位换算

1. **角度与脉冲**  
   - 1000 脉冲 = 360°  
   - 1° ≈ 2.78 脉冲  
   - 180° ≈ 500 脉冲

2. **速度**  
   - 用户配置速度的单位：**rpm**（转/分钟）  
   - 1 rpm = 6 °/s  
   - 若速度 \(v\)（°/s）需换算为 rpm，则  
     $$
     
       \text{rpm} = \frac{v(\text{°/s})}{6}
     $$
     
   
3. **加速度**  
   - 用户配置加速度的单位：**0.1 rps/s**  
   - 1 (0.1 rps/s) = 0.1 rev/s² = 36 °/s²  
   - 若加速度 \(a\)（°/s²）需换算为 0.1 rps/s，则  
     \[
       \text{(0.1 rps/s)} = \frac{a(\text{°/s}^2)}{36}
     \]  

4. **本示例选择**  
   - **最大速度**：2 rpm（即 12 °/s）  
   - **加速度**：1 (0.1 rps/s) = 36 °/s²  
   - 这样就能保证速度与加速度均为**整数**形式写入驱动器寄存器。

> **注意：** 在实际项目中，若需要恰好占满 20 s 并同时保证速度、加速度皆为整数精度，往往需要在末尾或开头“空转/等待”若干秒，使得**真正的加速+匀速+减速**三段之和不足 20 s，但**整个运动从开始到结束**恰好 20 s。

---

## 二、梯形速度曲线示例

### 1. 规划思路

- **最高速度**：\( V_{\max} = 12 \text{ °/s} \)（对应 2 rpm）  
- **加速度**：\( a = 36 \text{ °/s}^2 \)（对应 1 (0.1 rps/s)）  
- 以**加速-匀速-减速**三段构成一个完整的运动，计算出其时长与位移后，若总时长 < 20 s，则在最后加一段“停止等待”，使得整个过程恰好 20 s。

### 2. 计算过程

1. **加速阶段**  
   - 速度从 0 加速到 12 °/s，  
   - 加速度 \( a = 36 \text{ °/s}^2 \)  
   - 时间 \( t_{acc} = \frac{12}{36} = 0.333 \text{ s} \)  
   - 位移 \( S_{acc} = \frac{1}{2} \times 12 \times 0.333 = 2.0^\circ \)

2. **减速阶段**（与加速阶段对称）  
   - 同理，时间 \( t_{dec} = 0.333 \text{ s} \)  
   - 位移 \( S_{dec} = 2.0^\circ \)

3. **匀速阶段**  
   - 匀速速度：12 °/s  
   - 设匀速时间 \( t_{const} \)，使得总位移 = 180°  
   - 总位移 = \( S_{acc} + S_{dec} + S_{const} \)  
   - \( S_{const} = v \times t_{const} = 12 \times t_{const} \)  
   - 整体位移要求：  
     \[
       S_{acc} + S_{dec} + 12 \cdot t_{const} = 180 \quad \Rightarrow \quad
       2 + 2 + 12 \cdot t_{const} = 180 \quad \Rightarrow \quad
       12 \cdot t_{const} = 176 \quad \Rightarrow \quad
       t_{const} = 14.667 \text{ s}
     \]

4. **小结**  
   - 加速 0.333 s → 位移约 2°  
   - 匀速 14.667 s → 位移约 176°  
   - 减速 0.333 s → 位移约 2°  
   - **运动总时长** = 0.333 + 14.667 + 0.333 = 15.333 s  
   - **总位移** = 2 + 176 + 2 = 180°

5. **满足 20 s 的做法**  
   - 上述加速+匀速+减速仅耗时约 15.333 s  
   - 若必须占满 20 s，则在末尾增加约 4.667 s 的“停止等待”  
   - **整个过程**：  
     1. 0 ~ 0.333 s：加速  
     2. 0.333 ~ 15.0 s：匀速  
     3. 15.0 ~ 15.333 s：减速  
     4. 15.333 ~ 20 s：停止等待（速度=0）  
   - 这样总耗时 = 20 s，位移仍为 180°。

### 3. 参数表

| **阶段** | **时间** | **速度范围**           | **加速度**                | **位移** | **说明**                  |
| -------- | -------- | ---------------------- | ------------------------- | -------- | ------------------------- |
| 加速     | 0.333 s  | 0 → 12 °/s (0 → 2 rpm) | +36 °/s² (1 in 0.1 rps/s) | 2°       | 线性加速到 2 rpm          |
| 匀速     | 14.667 s | 恒定 12 °/s (2 rpm)    | 0                         | 176°     |                           |
| 减速     | 0.333 s  | 12 → 0 °/s (2 → 0 rpm) | –36 °/s²                  | 2°       | 线性减速回到 0 rpm        |
| 停止等待 | 4.667 s  | 0 rpm                  | 0                         | 0°       | 仅为凑满 20 s，总位移不变 |
| **合计** | 20 s     |                        |                           | 180°     | (含等待时间)              |

---

## 三、S 曲线示例

在满足“最大速度 = 2 rpm、最大加速度 = 1 (0.1 rps/s) = 36 °/s²”的前提下，要想实现更平滑的加速/减速，需要将加速阶段再细分为**上升斜坡 + 恒加速 + 下降斜坡**。然而，当加速度固定为 36 °/s²，且希望最终速度达到 12 °/s 时，**加速阶段将非常短**。例如：

- 令上升斜坡时间 \( t_r \) + 恒加速时间 \( t_{const\_acc} \) + 下降斜坡时间 \( t_{r\_down} \) = \( T_{acc} \)
- 若加速度峰值 = 36 °/s²，则从 0 到 36 °/s² 只需很短时间；为了在该阶段末速度达 12 °/s，整个加速阶段可能不到 1 s。

### 1. 设计思路（简化示例）
1. **假设**上升斜坡与下降斜坡各占 0.333 s，总加速阶段 0.666 s，最大加速度 36 °/s²，最终速度达 12 °/s；  
2. 匀速阶段让速度保持 12 °/s 一段时间；  
3. 减速阶段对称于加速阶段；  
4. 与梯形方案相同，由于加减速时间极短，完成 180° 只需 ~15 s，剩余时间仍需“停止等待”以填满 20 s。

### 2. 粗略计算

- **上升斜坡** (0 ~ 0.333 s):  
  - 加速度由 0→36 °/s² 线性上升  
  - 末端速度约 12 °/s  
  - 位移 ~ 2°  
- **下降斜坡** 同理也 ~ 2°  
- **匀速**：若希望在加速完后到减速开始前维持 12 °/s，令匀速时间 t_cv，使得总位移 = 180°。和梯形类似，可得匀速约 14.667 s，总用时 ~ 15.333 s，再加 4.667 s 等待。

### 3. 参数表

| **阶段**      | **时间**  | **加速度**  | **速度范围**           | **位移** | **说明**                                         |
| ------------- | --------- | ----------- | ---------------------- | -------- | ------------------------------------------------ |
| 上升斜坡      | ~0.333 s  | 0 → 36 °/s² | 0 → 12 °/s (0 → 2 rpm) | ~2°      | 平滑从 0 加速到峰值加速度 36 °/s²，再到 12 °/s   |
| 恒加速 (若有) | 很短或 0  | = 36 °/s²   | 12 → (可能略高)        | -        | 若想分成上升斜坡 + 恒加速 + 下降斜坡需做精细积分 |
| 下降斜坡      | ~0.333 s  | 36 → 0 °/s² | 12 → 0                 | ~2°      | 平滑降低加速度到 0，速度回到 0 或进入匀速/高于 0 |
| 匀速阶段      | ~14.667 s | 0           | 12 °/s (2 rpm)         | ~176°    | 与梯形同理，保证总位移 180°                      |
| 停止等待      | ~4.667 s  | 0           | 0 rpm                  | 0°       | 使总时长达 20 s                                  |
| **合计**      | 20 s      | -           | -                      | 180°     | 含等待时间                                       |

> **注**：S 曲线分为“上升斜坡 + 恒加速度 + 下降斜坡”三个子阶段，但当加速度峰值固定为 36 °/s²、目标速度仅 12 °/s 时，真正的加速时间非常短，很难在 20 s 的大框架内形成“长时间平滑加减速”的曲线；实际中大部分时间仍在匀速或等待阶段。

---

## 四、总结

- **速度、加速度取整限制**  
  - 速度：选 2 rpm（=12 °/s）  
  - 加速度：选 1 (0.1 rps/s)（=36 °/s²）  
- **总旋转 180° 用时 20 s**  
  - 真正的加减速+匀速过程只需 ~15 s 即可完成 180°；剩余 ~5 s 用于“停止等待”。
- **梯形曲线**与**S 曲线**的加减速阶段都非常短，主要时间在匀速或等待阶段；若想占满 20 s，只能在末尾追加空转时间。
- **最终效果**  
  - **梯形**：加速 0.333 s → 匀速 ~14.667 s → 减速 0.333 s → 等待 ~4.667 s  
  - **S 曲线**：上升斜坡 ~0.333 s + 匀速 ~14.667 s + 下降斜坡 ~0.333 s + 等待 ~4.667 s

这两种方案都满足“速度必须为整数 rpm、加速度必须为整数 0.1 rps/s”的要求，并在 20 s 内实现总位移 180°。不过可以看到，加减速阶段会非常短，导致大部分时间都在匀速或停止等待。若要更长的平滑加减速阶段，需要提高最大速度或降低总时长目标，这就无法兼顾“整数 rpm、整数加速度”与“占满 20 s”三者了。

------

